<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <title>ChatGPT UI Mockup</title>
  <style>
    * {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background-color: #1e1f23;
  color: #f0f0f0;
  display: flex;
  height: 100vh;
}

/* Sidebar */
.sidebar {
  width: 260px;
  background-color: #2a2b32;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  border-right: 1px solid #3c3d43;
}

.chat-list {
  padding: 1rem;
  flex: 1;
  overflow-y: auto;
}

.chat-item {
  padding: 0.75rem 1rem;
  margin-bottom: 0.6rem;
  background-color: #3c3d43;
  border-radius: 12px;
  cursor: pointer;
  transition: background-color 0.2s ease;
}

.chat-add {
  background-color: #151516 !important;
}

.selected-chat{
  background-color: #0e8a6c;
}

.chat-item:hover {
  filter: brightness(1.15);
}

.profile {
  padding: 0.5rem;
  border-top: 1px solid #3c3d43;
  display: flex;           
  flex-direction: row;      
  align-items: center;   
  justify-content: flex-start;  
  gap: 1rem;       
}

.profile button {
  background-color: #a31010;
  border: none;
  padding: 0.75rem 0.75rem;
  color: white;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
  transition: background-color 0.2s ease;
}

.profile button:hover {
  background-color: #6b0909;
}

/* Main Chat Area */
.main {
  flex: 1;
  display: flex;
  flex-direction: column;
}

header {
  padding: 1rem;
  background-color: #2a2b32;
  text-align: center;
  font-weight: 600;
  font-size: 1.1rem;
  border-bottom: 1px solid #3c3d43;
}

.chat-container {
  flex: 1;
  overflow-y: auto;
  padding: 1.5rem;
  display: flex;
  flex-direction: column;
  gap: 1.2rem;
}

.message {
  max-width: 75%;
  padding: 1rem 1.2rem;
  border-radius: 16px;
  white-space: pre-wrap;
  word-wrap: break-word;
  line-height: 1.5;
  font-size: 0.95rem;
}

.user {
  align-self: flex-end;
  background: linear-gradient(135deg, #565869, #474956);
  color: white;
}

.assistant {
  align-self: flex-start;
  background-color: #3c3d43;
  color: #e2e2e2;
}

/* Input Area */
.input-area {
  display: flex;
  align-items: center;
  padding: 1rem;
  border-top: 1px solid #3c3d43;
  background-color: #2a2b32;
  gap: 0.5rem;
  position: relative;
}

.input-area input {
  flex: 1;
  padding: 0.9rem 1rem;
  border: none;
  border-radius: 12px;
  background-color: #40414f;
  color: white;
  font-size: 1rem;
  transition: background-color 0.2s ease;
}

.input-area input:focus {
  outline: none;
  background-color: #4f505d;
}

.input-area button {
  background-color: #10a37f;
  color: white;
  padding: 0.75rem 1.2rem;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  font-weight: bold;
  transition: background-color 0.2s ease;
}

.input-area button:hover {
  background-color: #0e8a6c;
}

/* Dropdown */
.dropdown-toggle {
  background-color: #40414f;
  border: none;
  color: white;
  padding: 0.6rem 0.9rem;
  border-radius: 10px;
  cursor: pointer;
  font-size: 1.1rem;
  transition: background-color 0.2s ease;
}

.dropdown-toggle:hover {
  background-color: #4f505d;
}

.dropdown-menu {
  position: absolute;
  bottom: 65px;
  left: 12px;
  background-color: #2a2b32;
  border: 1px solid #444;
  border-radius: 10px;
  padding: 0.75rem 1rem;
  display: none;
  flex-direction: column;
  gap: 0.75rem;
  z-index: 999;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.dropdown-menu label {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 0.95rem;
  color: #e0e0e0;
}

.dropdown-menu input[type="checkbox"] {
  transform: scale(1.2);
}

/* Microphone */
.mic-button {
  background-color: #40414f;
  border: none;
  color: white;
  padding: 0.6rem;
  border-radius: 50%;
  cursor: pointer;
  font-size: 1.1rem;
  transition: background-color 0.2s ease;
}

.mic-button:hover {
  background-color: #4f505d;
}
@media (max-width: 1024px) {
  .sidebar {
    width: 200px;
  }

  .chat-item {
    font-size: 0.9rem;
    padding: 0.5rem 0.8rem;
  }


  .dropdown-toggle,
  .mic-button,
  .input-area button {
    font-size: 0.9rem;
  }

  .input-area input {
    font-size: 0.9rem;
  }
}

@media (max-width: 768px) {
  body {
    flex-direction: column;
  }

  .sidebar {
    width: 100%;
    height: auto;
    flex-direction: row;
    overflow-x: auto;
    border-right: none;
    border-bottom: 1px solid #3c3d43;
  }

  .chat-list {
    flex-direction: row;
    display: flex;
    flex-wrap: nowrap;
    padding: 0.5rem;
    gap: 0.5rem;
  }

  .chat-item {
    flex-shrink: 0;
    white-space: nowrap;
    margin-top: 0.5rem;
  }

  .main {
    flex: 1;
    display: flex;
    flex-direction: column;
    width: 100%;
  }

  header {
    font-size: 1rem;
    padding: 0.75rem;
  }

  .chat-container {
    padding: 1rem 0.75rem;
    font-size: 0.9rem;
  }

  .message {
    font-size: 0.9rem;
    padding: 0.75rem;
    border-radius: 14px;
  }

  .input-area {
    flex-wrap: wrap;
    gap: 0.5rem;
    padding: 0.75rem;
  }

  .input-area input {
    width: 100%;
    padding: 0.75rem;
    border-radius: 10px;
  }

  .input-area button,
  .dropdown-toggle,
  .mic-button {
    padding: 0.6rem;
    border-radius: 8px;
    font-size: 0.9rem;
  }

  .dropdown-menu {
    left: 0;
    right: auto;
  }
}

  </style>
</head>
<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <div class="chat-list">
      <div class="chat-item chat-add" onclick="addNewChat()">New chat</div>
    </div>
    <div class="profile">
      <button onclick="logout()">Log out</button>
      <div>{{username}}</div>      
    </div>
  </div>

  <!-- Main Content -->
  <div class="main">
    <header>ChatGPT Mockup</header>

    <div class="chat-container" id="chat">
      <!-- <div class="message assistant">Hello! How can I help you today?</div> -->
    </div>

    <div class="input-area">
      <!-- Dropdown -->
      <div>
        <button class="dropdown-toggle" onclick="toggleDropdown()">☰</button>
        <div class="dropdown-menu" id="dropdownMenu">
          <label>
            Return Audio
            <input type="checkbox" id="toggleAudio">
          </label>
          <label>
            Return Picture
            <input type="checkbox" id="togglePicture">
          </label>
        </div>
      </div>

      <input type="text" id="userInput" placeholder="Send a message..." />
      <button class="mic-button" onclick="alert('Microphone activated! 🎤')">🎤</button>
      <button onclick="sendMessage()">Send</button>

      <!-- Microphone -->
      
    </div>
  </div>

  <script>
    getChatsHistory();
    function logout() {
      document.cookie = "username=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
      location.reload();
    }
    function sendMessage() {
      const input = document.getElementById("userInput");
      const text = input.value.trim();
      if (text === "") return;

      const chat = document.getElementById("chat");

      const userMessage = document.createElement("div");
      userMessage.className = "message user";
      userMessage.textContent = text;
      chat.appendChild(userMessage);

      const assistantMessage = document.createElement("div");
      assistantMessage.className = "message assistant";
      let response = "This is a static response.";
      if (document.getElementById("toggleAudio").checked) {
        response += " 🔊 [Audio enabled]";
      }
      if (document.getElementById("togglePicture").checked) {
        response += " 🖼️ [Picture enabled]";
      }
      assistantMessage.textContent = response;
      chat.appendChild(assistantMessage);

      input.value = "";
      chat.scrollTop = chat.scrollHeight;
    }

    function toggleDropdown() {
      const menu = document.getElementById("dropdownMenu");
      menu.style.display = menu.style.display === "flex" ? "none" : "flex";
    }

    // Close dropdown if clicked outside
    document.addEventListener("click", function (e) {
      const menu = document.getElementById("dropdownMenu");
      const toggle = document.querySelector(".dropdown-toggle");
      if (!menu.contains(e.target) && !toggle.contains(e.target)) {
        menu.style.display = "none";
      }
    });

    function addNewChat(name = "Chat!", id = 0, isNew = true) {
      const chatList = document.querySelector(".chat-list");
      const newChatItem = document.createElement("div");
      newChatItem.className = "chat-item";
      newChatItem.textContent = name;
      newChatItem.onclick = function() {
        selectChat(newChatItem, id);
      };
      chatList.appendChild(newChatItem);
      if(!isNew) return;

      fetch('/api/add_chat', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          username: '{{username}}',
          chatname: newChatItem.textContent
        })
      }).then(response => {
        if (!response.ok) {
          chatList.removeChild(newChatItem);
        }
        return response.json();
      }).then(data => {
        console.log('Chat added successfully:', data);
      }).catch(error => {
        chatList.removeChild(newChatItem);
      });

      
    }

    function selectChat(chat, id){
      const chatItems = document.querySelectorAll(".chat-item");
      chatItems.forEach(item => {
        if(item !== chat) {
          item.classList.remove("selected-chat");
        }
        else {
          item.classList.add("selected-chat");
        }
      });
      this.classList.add("chat-selectable");
    }

    function getChatsHistory()
    {
      fetch('/api/get_chats', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          username: '{{username}}'
        })
      }).then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.json();
      }).then(data => {
        const chats = data.chats;
            chats.forEach(chat => {
          addNewChat(chat.chat_name, chat.id, false);
            });
      }).catch(error => {
        console.error('There was a problem with the fetch operation:', error);
      });
    }
  </script>

</body>
</html>
